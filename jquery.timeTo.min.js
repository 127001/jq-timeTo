/**
 * TimeTo jQuery plug-in
 * Show countdown timer or realtime clock
 *
 * @author Alexey Teterin <altmoc@gmail.com>
 * @version 1.0.2
 * @license MIT http://opensource.org/licenses/MIT
 * @date 2013-05-06
 */

(function(m){function r(d){var g=this.data(),a=this.find("ul");if(g.vals&&0!=a.length){d||(d=g.seconds);var f=!1;g.intervalId&&(f=!0,clearTimeout(g.intervalId));var c=Math.floor(d/86400),e=86400*c,h=Math.floor((d-e)/3600),e=e+3600*h,j=Math.floor((d-e)/60);d-=e+60*j;c=(100>c?"0"+(10>c?"0":""):"")+c+(10>h?"0":"")+h+(10>j?"0":"")+j+(10>d?"0":"")+d;h=g.vals.length-1;for(j=c.length-1;0<=h;h--,j--)d=parseInt(c.substr(j,1)),g.vals[h]=d,a.eq(h).children().html(d);if(f){var b=this;g.ttStartTime=Date.now();
g.intervalId=setTimeout(function(){p.call(b)},1E3);this.data("intervalId",g.intervalId)}}}function p(d){var g=this.find("ul"),a=this.data();if(!a.vals||0==g.length)a.intervalId&&(clearTimeout(a.intervalId),this.data("intervalId",null)),a.callback&&a.callback();else{void 0==d&&(d=a.iSec);var f=a.vals[d],c=g.eq(d),e=c.children(),h=a.countdown?-1:1;e.eq(1).html(f);f+=h;if(d==a.iSec){var j=a.tickTimeout,b=Date.now()-a.ttStartTime;a.sec+=h;j+=Math.abs(a.seconds-a.sec)*j-b;a.intervalId=setTimeout(function(){p.call(s)},
j)}if(0>f||f>a.limits[d])f=0>f?a.limits[d]:0,0<d&&p.call(this,d-1);e.eq(0).html(f);var s=this;c.addClass("transition");c.css({top:0});setTimeout(function(){c.removeClass("transition");e.eq(1).html(f);c.css({top:"-"+a.height+"px"});0<h||d!=a.iSec||(a.sec==a.countdownAlertLimit&&g.parent().addClass("timeTo-alert"),0===a.sec&&(g.parent().removeClass("timeTo-alert"),a.intervalId&&(clearTimeout(a.intervalId),s.data("intervalId",null)),"function"===typeof a.callback&&a.callback()))},410);a.vals[d]=f}}var n=
{start:function(d){d&&r.call(this,d);var g=this;d=setTimeout(function(){p.call(g)},1E3);this.data("ttStartTime",Date.now());this.data("intervalId",d)},stop:function(){var d=this.data();d.intervalId&&(clearTimeout(d.intervalId),this.data("intervalId",null));return d},reset:function(d){var g=n.stop.call(this);this.find("div").css({backgroundPosition:"left center"});"undefined"===typeof d&&(d=g.value);r.call(this,d)}},q={en:{days:"days",hours:"hours",min:"minutes",sec:"seconds"},ru:{days:"\u0434\u043d\u0435\u0439",
hours:"\u0447\u0430\u0441\u043e\u0432",min:"\u043c\u0438\u043d\u0443\u0442",sec:"\u0441\u0435\u043a\u0443\u043d\u0434"},ua:{days:"\u0434\u043di\u0432",hours:"\u0433\u043e\u0434\u0438\u043d",min:"\u0445\u0432\u0438\u043b\u0438\u043d",sec:"\u0441\u0435\u043a\u0443\u043d\u0434"},de:{days:"Tag",hours:"Uhr",min:"Minuten",sec:"Secunden"},fr:{days:"jours",hours:"heures",min:"minutes",sec:"secondes"},sp:{days:"d\u00edas",hours:"reloj",min:"minutos",sec:"segundos"}};m.fn.timeTo=function(){for(var d={callback:null,
captionSize:0,countdown:!0,countdownAlertLimit:10,displayCaptions:!1,displayDays:!1,fontFamily:"Verdana, sans-serif",fontSize:28,lang:"en",seconds:0,start:!0,theme:"white",vals:[0,0,0,0,0,0,0,0,0],limits:[9,9,9,2,9,5,9,5,9],iSec:8,iHour:4,tickTimeout:1E3,intervalId:null},g,a={},f=0,c;c=arguments[f];++f)0==f&&"string"===typeof c?g=c:"object"==typeof c?"function"===typeof c.getTime?a.timeTo=c:a=m.extend(a,c):"function"==typeof c?a.callback=c:(c=parseInt(c),isNaN(c)||(a.seconds=c));if(a.timeTo){var e;
a.timeTo.getTime?e=a.timeTo.getTime():"number"===typeof a.timeTo&&(e=a.timeTo);a.timeTo>Date.now()&&(a.seconds=Math.floor((e-Date.now())/1E3))}else if(a.time||!a.seconds)if((e=a.time)||(e=new Date),"object"===typeof e&&e.getTime)a.seconds=3600*e.getHours()+60*e.getMinutes()+e.getSeconds(),a.countdown=!1;else if("string"===typeof e){f=e.split(":");e=0;c=1;for(var h;h=f.pop();)e+=h*c,c*=60;a.seconds=e;a.countdown=!1}!1!==a.countdown&&86400<a.seconds&&(a.displayDays=!0);return this.each(function(){var c=
m(this),b=c.data();if(b.vals)b.intervalId&&(clearInterval(b.intervalId),b.intervalId=null),m.extend(b,a);else{b=m.extend(d,a);b.height=Math.round(100*b.fontSize/93);b.width=Math.round(0.8*b.fontSize+0.13*b.height);c.addClass("timeTo").addClass("timeTo-"+b.theme).css({fontFamily:b.fontFamily,fontSize:b.fontSize+"px"});var e='<ul style="left:'+Math.round(b.height/10)+"px; top:-"+b.height+'px"><li>0</li><li>0</li></ul></div>',f=' style="width:'+b.width+"px; height:"+b.height+'px;"',h='<div class="first"'+
f+">"+e,e="<div"+f+">"+e,k=Math.round(2*b.width+3),f=b.captionSize||Math.round(0.43*b.fontSize);thtml=(b.displayCaptions?'<figure style="max-width:'+k+'px">$1<figcaption style="font-size:'+f+'px">'+q[b.lang].hours+'</figcaption></figure><span>:</span><figure style="max-width:'+k+'px">$1<figcaption style="font-size:'+f+'px">'+q[b.lang].min+'</figcaption></figure><span>:</span><figure style="max-width:'+k+'px">$1<figcaption style="font-size:'+f+'px">'+q[b.lang].sec+"</figcaption></figure>":"$1<span>:</span>$1<span>:</span>$1").replace(/\$1/g,
h+e);b.displayDays&&(k=0.4*b.fontSize,thtml=(b.displayCaptions?'<figure style="width:'+Math.round(3*b.width+k)+'px">$1<figcaption style="font-size:'+f+"px; padding-right:"+Math.round(k)+'px">'+q[b.lang].days+"</figcaption></figure>":"$1").replace(/\$1/,h+e+(b.displayCaptions?e:e.replace('">'," margin-right:"+Math.round(k)+'px">')))+thtml);c.html(thtml)}h=c.find("div");if(h.length<b.vals.length){e=b.vals.length-h.length;f=b.vals;k=b.limits;b.vals=[];b.limits=[];for(var l=0;l<h.length;l++)b.vals[l]=
f[e+l],b.limits[l]=k[e+l];b.iSec=b.vals.length-1;b.iHour=b.vals.length-5}b.sec=b.seconds;c.data(b);g&&n[g]?n[g].call(c,b.seconds):b.start?n.start.call(c,b.seconds):n.init.call(c,b.seconds)})}})(jQuery);
