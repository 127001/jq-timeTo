/**
 * QTimer jQuery plug-in
 * Show countdown timer or realtime clock
 *
 * @author Alexey Teterin <altmoc@gmail.com>
 * @version 1.0
 * @license MIT http://opensource.org/licenses/MIT
 * @date 2013-04-21
 */

(function(n){function q(d){var g=this.data(),b=this.find("ul");if(g.vals&&0!=b.length){d||(d=g.seconds);var f=!1;g.intervalId&&(f=!0,clearInterval(g.intervalId));var c=Math.floor(d/86400),e=86400*c,h=Math.floor((d-e)/3600),e=e+3600*h,k=Math.floor((d-e)/60);d-=e+60*k;c=(100>c?"0"+(10>c?"0":""):"")+c+(10>h?"0":"")+h+(10>k?"0":"")+k+(10>d?"0":"")+d;h=g.vals.length-1;for(k=c.length-1;0<=h;h--,k--)d=parseInt(c.substr(k,1)),g.vals[h]=d,b.eq(h).children().html(d);if(f){var a=this;g.intervalId=setInterval(function(){l.tick.call(a)},
1E3);this.data("intervalId",g.intervalId)}}}function r(d){var g=this.find("ul"),b=this.data();if(!b.vals||0==g.length)b.intervalId&&(clearInterval(b.intervalId),this.data("intervalId",null)),b.callback&&b.callback();else{void 0==d&&(d=b.iSec);var f=b.vals[d],c=g.eq(d),e=c.children(),h=b.countdown?-1:1;e.eq(1).html(f);f+=h;d==b.iSec&&(b.sec+=h);if(0>f||f>b.limits[d])f=0>f?b.limits[d]:0,0<d&&r.call(this,d-1);e.eq(0).html(f);var k=this;c.addClass("transition");c.css({top:0});setTimeout(function(){c.removeClass("transition");
e.eq(1).html(f);c.css({top:"-"+b.height+"px"});0<h||d!=b.iSec||(b.sec==b.countdownAlertLimit?g.parent().addClass("timeTo-alert"):0==b.sec&&(g.parent().removeClass("timeTo-alert"),b.intervalId&&(clearInterval(b.intervalId),k.data("intervalId",null)),"function"===typeof b.callback&&b.callback()))},500);b.vals[d]=f}}var l={start:function(d){d&&q.call(this,d);var g=this;d=setInterval(function(){r.call(g)},1E3);this.data("intervalId",d)},stop:function(){var d=this.data();d.intervalId&&(clearInterval(d.intervalId),
this.data("intervalId",null));return d},reset:function(d){var g=l.stop.call(this);this.find("div").css({backgroundPosition:"left center"});"undefined"===typeof d&&(d=g.value);q.call(this,d)}},p={en:{days:"days",hours:"hours",min:"minutes",sec:"seconds"},ru:{days:"\u0434\u043d\u0435\u0439",hours:"\u0447\u0430\u0441\u043e\u0432",min:"\u043c\u0438\u043d\u0443\u0442",sec:"\u0441\u0435\u043a\u0443\u043d\u0434"},ua:{days:"\u0434\u043di\u0432",hours:"\u0433\u043e\u0434\u0438\u043d",min:"\u0445\u0432\u0438\u043b\u0438\u043d",
sec:"\u0441\u0435\u043a\u0443\u043d\u0434"},de:{days:"Tag",hours:"Uhr",min:"Minuten",sec:"Secunden"},fr:{days:"jours",hours:"heures",min:"minutes",sec:"secondes"},sp:{days:"d\u00edas",hours:"reloj",min:"minutos",sec:"segundos"}};n.fn.timeTo=function(){for(var d={callback:null,captionSize:0,countdown:!0,countdownAlertLimit:10,displayCaptions:!1,displayDays:!1,fontFamily:"Verdana, sans-serif",fontSize:28,lang:"en",seconds:0,start:!0,theme:"white",vals:[0,0,0,0,0,0,0,0,0],limits:[9,9,9,2,9,5,9,5,9],
iSec:8,iHour:4,intervalId:null},g,b={},f=0,c;c=arguments[f];++f)0==f&&"string"===typeof c?g=c:"object"==typeof c?"function"===typeof c.getTime?b.timeTo=c:b=n.extend(b,c):"function"==typeof c?b.callback=c:(c=parseInt(c),isNaN(c)||(b.seconds=c));if(b.timeTo){var e;b.timeTo.getTime?e=b.timeTo.getTime():"number"===typeof b.timeTo&&(e=b.timeTo);b.timeTo>Date.now()&&(b.seconds=Math.floor((e-Date.now())/1E3))}else if(b.time||!b.seconds)if((e=b.time)||(e=new Date),"object"===typeof e&&e.getTime)b.seconds=
3600*e.getHours()+60*e.getMinutes()+e.getSeconds(),b.countdown=!1;else if("string"===typeof e){f=e.split(":");e=0;c=1;for(var h;h=f.pop();)e+=h*c,c*=60;b.seconds=e;b.countdown=!1}!1!==b.countdown&&86400<b.seconds&&(b.displayDays=!0);return this.each(function(){var c=n(this),a=c.data();if(a.vals)a.intervalId&&(clearInterval(a.intervalId),a.intervalId=null),n.extend(a,b);else{a=n.extend(d,b);a.height=Math.round(100*a.fontSize/93);a.width=Math.round(0.8*a.fontSize+0.13*a.height);c.addClass("timeTo").addClass("timeTo-"+
a.theme).css({fontFamily:a.fontFamily,fontSize:a.fontSize+"px"});var e='<ul style="left:'+Math.round(a.height/10)+"px; top:-"+a.height+'px"><li>0</li><li>0</li></ul></div>',f=' style="width:'+a.width+"px; height:"+a.height+'px;"',h='<div class="first"'+f+">"+e,e="<div"+f+">"+e,j=Math.round(2*a.width+3),f=a.captionSize||Math.round(0.43*a.fontSize);thtml=(a.displayCaptions?'<figure style="max-width:'+j+'px">$1<figcaption style="font-size:'+f+'px">'+p[a.lang].hours+'</figcaption></figure><span>:</span><figure style="max-width:'+
j+'px">$1<figcaption style="font-size:'+f+'px">'+p[a.lang].min+'</figcaption></figure><span>:</span><figure style="max-width:'+j+'px">$1<figcaption style="font-size:'+f+'px">'+p[a.lang].sec+"</figcaption></figure>":"$1<span>:</span>$1<span>:</span>$1").replace(/\$1/g,h+e);a.displayDays&&(j=0.4*a.fontSize,thtml=(a.displayCaptions?'<figure style="width:'+Math.round(3*a.width+j)+'px">$1<figcaption style="font-size:'+f+"px; padding-right:"+Math.round(j)+'px">'+p[a.lang].days+"</figcaption></figure>":
"$1").replace(/\$1/,h+e+(a.displayCaptions?e:e.replace('">'," margin-right:"+Math.round(j)+'px">')))+thtml);c.html(thtml)}h=c.find("div");if(h.length<a.vals.length){e=a.vals.length-h.length;f=a.vals;j=a.limits;a.vals=[];a.limits=[];for(var m=0;m<h.length;m++)a.vals[m]=f[e+m],a.limits[m]=j[e+m];a.iSec=a.vals.length-1;a.iHour=a.vals.length-5}a.sec=a.seconds;c.data(a);g&&l[g]?l[g].call(c,a.seconds):a.start?l.start.call(c,a.seconds):l.init.call(c,a.seconds)})}})(jQuery);
